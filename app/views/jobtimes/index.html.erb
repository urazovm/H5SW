<%= gmaps4rails(@json) %><br/><br/>
<div id="clock">
  <%= button_tag "Start", :onclick => "clockStart()",:id => "start"%>
  <%= button_tag "Stop", :onclick => "clockStop()",:disabled => true,:id => "stop" %>
  <span id="hour">hh</span>:
  <span id="min">mm</span>:
  <span id="sec">ss</span>
</div>
<hr />

<%= render '/layouts/job_with_action' %>
<%= render '/layouts/tab_panel_for_job' %>


<%= link_to_function "Add time", ("alert('Click on start button to start your time'); $('#start').removeAttr('disabled');"), :class => "btn btn-small btn-primary" %>
<%= link_to "Add schedule", new_jobtime_path, :class => "btn btn-small btn-primary" %>
<hr />
<table class ="table-striped">
  <tr style="text-align: left;">
    <th>Type</th>
    <th>Date</th>
    <th>Qty</th>
    <th>Who</th>
    <th>Service</th>
  </tr>

  <% @jobtimes.each do |jobtime| %>
    <tr>
      <td><%= jobtime.timetype %></td>
      <td><%= jobtime.start_time %></td>
      <td><%= jobtime.qty %></td>
      <td><%= jobtime.user %></td>
      <td><%= jobtime.service != nil ? Item.find(jobtime.service).name : '' %></td>
    </tr>
  <% end %>

</table>

<script>
  var timerId,start_time,end_time;
  function update() {
    var date = new Date()
    var hours = date.getHours()
    if (hours < 10) hours = '0'+ hours
    document.getElementById('hour').innerHTML = hours

    var minutes = date.getMinutes()
    if (minutes < 10) minutes = '0'+minutes
    document.getElementById('min').innerHTML = minutes
    
    var seconds = date.getSeconds()
    if (seconds < 10) seconds = '0'+seconds
    document.getElementById('sec').innerHTML = seconds
    timerId = setTimeout(update, 1000)
  }


  function clockStart() {
    var date = new Date()
    start_time = date
    $("#start").attr("disabled", "disabled");
    $("#stop").removeAttr("disabled");
    if (timerId) return
    update()
  }


  function clockStop() {
    var date = new Date()
    clearTimeout(timerId)
    end_time = date
    $("#stop").attr("disabled", "disabled");
    $("#start").removeAttr("disabled");
    timerId = null
    $.ajax({
      url: '/jobtimes',
      data:{
        start_time:start_time,
        end_time:end_time
      },
      method:'POST',
      success:function(data){}
    });
  }

</script>



